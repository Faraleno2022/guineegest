{% extends 'fleet_app/base.html' %}
{% load static %}

{% block title %}Nouveau Fournisseur{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-truck me-2"></i>Nouveau fournisseur
                    </h5>
                </div>
                <div class="card-body">
                    <form method="post" novalidate>
                        {% csrf_token %}
                        
                        <!-- Informations principales -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="nom" class="form-label">Nom du fournisseur *</label>
                                <input type="text" class="form-control {% if errors.nom %}is-invalid{% endif %}" 
                                       id="nom" name="nom" 
                                       value="{{ form_data.nom|default:'' }}" 
                                       placeholder="Ex: Transport Express SARL" required>
                                {% if errors.nom %}
                                    <div class="invalid-feedback">{{ errors.nom }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label for="contact" class="form-label">Nom du contact *</label>
                                <input type="text" class="form-control {% if errors.contact %}is-invalid{% endif %}" 
                                       id="contact" name="contact" 
                                       value="{{ form_data.contact|default:'' }}" 
                                       placeholder="Ex: M. Mamadou Diallo" required>
                                {% if errors.contact %}
                                    <div class="invalid-feedback">{{ errors.contact }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Contact -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="telephone" class="form-label">Téléphone *</label>
                                <input type="tel" class="form-control {% if errors.telephone %}is-invalid{% endif %}" 
                                       id="telephone" name="telephone" 
                                       value="{{ form_data.telephone|default:'' }}" 
                                       placeholder="Ex: +224 123 456 789" required>
                                {% if errors.telephone %}
                                    <div class="invalid-feedback">{{ errors.telephone }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control {% if errors.email %}is-invalid{% endif %}" 
                                       id="email" name="email" 
                                       value="{{ form_data.email|default:'' }}" 
                                       placeholder="Ex: contact@transport-express.gn">
                                {% if errors.email %}
                                    <div class="invalid-feedback">{{ errors.email }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Adresse -->
                        <div class="row mb-3">
                            <div class="col-12">
                                <label for="adresse" class="form-label">Adresse</label>
                                <input type="text" class="form-control" 
                                       id="adresse" name="adresse" 
                                       value="{{ form_data.adresse|default:'' }}" 
                                       placeholder="Ex: Quartier Almamya, Rue KA-025">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="ville" class="form-label">Ville</label>
                                <input type="text" class="form-control" 
                                       id="ville" name="ville" 
                                       value="{{ form_data.ville|default:'' }}" 
                                       placeholder="Ex: Conakry">
                            </div>
                            <div class="col-md-6">
                                <label for="pays" class="form-label">Pays</label>
                                <input type="text" class="form-control" 
                                       id="pays" name="pays" 
                                       value="{{ form_data.pays|default:'Guinée' }}" 
                                       placeholder="Ex: Guinée">
                            </div>
                        </div>

                        <!-- Notes -->
                        <div class="row mb-3">
                            <div class="col-12">
                                <label for="notes" class="form-label">Notes</label>
                                <textarea class="form-control" id="notes" name="notes" 
                                          rows="3" placeholder="Commentaires, spécialités, conditions particulières...">{{ form_data.notes|default:'' }}</textarea>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between mt-4">
                            <a href="{% url 'fleet_app:fournisseur_location_list' %}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Annuler
                            </a>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save me-2"></i>Enregistrer le fournisseur
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Informations d'aide -->
<div class="container mt-3">
    <div class="row">
        <div class="col-12">
            <div class="alert alert-info">
                <h6><i class="fas fa-info-circle me-2"></i>Informations</h6>
                <ul class="mb-0">
                    <li><strong>Champs obligatoires :</strong> Nom du fournisseur, nom du contact, téléphone</li>
                    <li><strong>Email :</strong> Optionnel mais doit être au format valide si fourni</li>
                    <li><strong>Unicité :</strong> Le nom du fournisseur doit être unique pour votre entreprise</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Auto-focus sur le premier champ
    $('#nom').focus();
    
    // Validation en temps réel de l'email
    $('#email').on('blur', function() {
        const email = $(this).val();
        const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        
        if (email && !emailPattern.test(email)) {
            $(this).addClass('is-invalid');
            if (!$(this).next('.invalid-feedback').length) {
                $(this).after('<div class="invalid-feedback">Format d\'email invalide</div>');
            }
        } else {
            $(this).removeClass('is-invalid');
            $(this).next('.invalid-feedback').remove();
        }
    });
    
    // Formatage automatique du téléphone
    $('#telephone').on('input', function() {
        let value = $(this).val().replace(/\D/g, ''); // Garder seulement les chiffres
        
        // Format guinéen: +224 XXX XXX XXX
        if (value.startsWith('224')) {
            value = '+' + value.substring(0, 3) + ' ' + 
                    value.substring(3, 6) + ' ' + 
                    value.substring(6, 9) + ' ' + 
                    value.substring(9, 12);
        } else if (value.length > 0 && !value.startsWith('224')) {
            // Ajouter +224 si pas présent
            value = '+224 ' + value.substring(0, 3) + ' ' + 
                    value.substring(3, 6) + ' ' + 
                    value.substring(6, 9);
        }
        
        $(this).val(value);
    });
});
</script>
{% endblock %}
