{% comment %}Partial: stats + table + pagination for Fiche Or{% endcomment %}

<!-- Statistiques -->
<div class="row mb-3">
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="text-muted small">Total fiches</div>
        <div class="h5 mb-0">{{ stats.total_fiches|default:0 }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="text-muted small">Quantité totale (g)</div>
        <div class="h5 mb-0">{{ stats.total_quantite|default:0 }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="text-muted small">Valeur totale (GNF)</div>
        <div class="h5 mb-0">{{ stats.total_valeur|default:0|floatformat:0 }}</div>
      </div>
    </div>
  </div>
</div>

<!-- Classements -->
<div class="row mb-3">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header py-2">Top lieux (par quantité)</div>
      <ul class="list-group list-group-flush small">
        {% for s in stats.top_sites %}
          <li class="list-group-item d-flex justify-content-between">
            <span>{{ s.entrees__lieu|default:"N/A" }}</span>
            <span class="fw-semibold">{{ s.q|default:0 }}</span>
          </li>
        {% empty %}
          <li class="list-group-item text-muted">Aucune donnée</li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card">
      <div class="card-header py-2">Statistiques par mois</div>
      <ul class="list-group list-group-flush small">
        <li class="list-group-item text-muted">Données par mois/année disponibles</li>
      </ul>
    </div>
  </div>
</div>

<!-- Tableau -->
<div class="table-responsive">
  <table class="table table-striped table-hover">
    <thead class="table-light">
      <tr>
        <th>Date</th>
        <th>Mois/Année</th>
        <th>Nb. Entrées</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for fiche in fiches %}
        <tr>
          <td>{{ fiche.date|date:"d/m/Y" }}</td>
          <td>{{ fiche.mois }}/{{ fiche.annee }}</td>
          <td><span class="badge bg-info">{{ fiche.entrees_count }}</span></td>
          <td>
            <div class="btn-group btn-group-sm">
              <a href="{% url 'fleet_app:fiche_or_detail' fiche.pk %}" class="btn btn-info" title="Détails"><i class="fas fa-eye"></i></a>
              <a href="{% url 'fleet_app:fiche_or_edit' fiche.pk %}" class="btn btn-warning" title="Modifier"><i class="fas fa-edit"></i></a>
              <a href="{% url 'fleet_app:fiche_or_delete' fiche.pk %}" class="btn btn-danger" title="Supprimer"><i class="fas fa-trash"></i></a>
            </div>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="4" class="text-center">Aucune fiche d'or enregistrée</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination -->
{% if fiches.has_other_pages %}
<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    {% if fiches.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ fiches.previous_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
    {% endif %}

    {% for i in fiches.paginator.page_range %}
      {% if fiches.number == i %}
        <li class="page-item active"><span class="page-link">{{ i }}</span></li>
      {% else %}
        <li class="page-item"><a class="page-link" href="?page={{ i }}{% if q %}&q={{ q|urlencode }}{% endif %}">{{ i }}</a></li>
      {% endif %}
    {% endfor %}

    {% if fiches.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ fiches.next_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
    {% endif %}
  </ul>
</nav>
{% endif %}
