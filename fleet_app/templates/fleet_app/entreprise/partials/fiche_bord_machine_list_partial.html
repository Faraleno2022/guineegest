{% comment %}Partial: stats + table + pagination for Fiche Bord Machine{% endcomment %}

<!-- Statistiques -->
<div class="row mb-3">
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="text-muted small">Total fiches</div>
        <div class="h5 mb-0">{{ stats.total_fiches|default:0 }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="text-muted small">Heures totales</div>
        <div class="h5 mb-0">{{ stats.total_heures|default:0 }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="text-muted small">Carburant total (L)</div>
        <div class="h5 mb-0">{{ stats.total_carburant|default:0 }}</div>
      </div>
    </div>
  </div>
</div>

<!-- Classements -->
<div class="row mb-3">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header py-2">Top machines (par heures)</div>
      <ul class="list-group list-group-flush small">
        {% for m in stats.top_machines %}
          <li class="list-group-item d-flex justify-content-between">
            <span>{{ m.machine__nom }} ({{ m.machine__immatriculation }})</span>
            <span class="fw-semibold">{{ m.heures|default:0 }}</span>
          </li>
        {% empty %}
          <li class="list-group-item text-muted">Aucune donnée</li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card">
      <div class="card-header py-2">Top chauffeurs (par heures)</div>
      <ul class="list-group list-group-flush small">
        {% for c in stats.top_chauffeurs %}
          <li class="list-group-item d-flex justify-content-between">
            <span>{{ c.chauffeur__prenom }} {{ c.chauffeur__nom }}</span>
            <span class="fw-semibold">{{ c.heures|default:0 }}</span>
          </li>
        {% empty %}
          <li class="list-group-item text-muted">Aucune donnée</li>
        {% endfor %}
      </ul>
    </div>
  </div>
</div>

<!-- Tableau -->
<div class="table-responsive">
  <table class="table table-striped table-hover">
    <thead class="table-light">
      <tr>
        <th>Date</th>
        <th>Machine</th>
        <th>Chauffeur</th>
        <th>Heures de travail</th>
        <th>Carburant (L)</th>
        <th>Nb. Entrées</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for fiche in fiches %}
        <tr>
          <td>{{ fiche.date|date:"d/m/Y" }}</td>
          <td>
            {% if fiche.machine.nom %}
              {{ fiche.machine.nom }} ({{ fiche.machine.immatriculation }})
            {% else %}
              {{ fiche.machine }}
            {% endif %}
          </td>
          <td>
            {% if fiche.chauffeur.prenom %}
              {{ fiche.chauffeur.prenom }} {{ fiche.chauffeur.nom }}
            {% else %}
              {{ fiche.chauffeur }}
            {% endif %}
          </td>
          <td>{{ fiche.heures_travail }}</td>
          <td>{{ fiche.carburant_consomme }}</td>
          <td><span class="badge bg-info">{{ fiche.entrees_count }}</span></td>
          <td>
            <div class="btn-group btn-group-sm">
              <a href="{% url 'fleet_app:fiche_bord_machine_detail' fiche.pk %}" class="btn btn-info" title="Détails"><i class="fas fa-eye"></i></a>
              <a href="{% url 'fleet_app:fiche_bord_machine_edit' fiche.pk %}" class="btn btn-warning" title="Modifier"><i class="fas fa-edit"></i></a>
              <a href="{% url 'fleet_app:fiche_bord_machine_delete' fiche.pk %}" class="btn btn-danger" title="Supprimer"><i class="fas fa-trash"></i></a>
            </div>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="7" class="text-center">Aucune fiche de bord machine enregistrée</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination -->
{% if fiches.has_other_pages %}
<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    {% if fiches.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ fiches.previous_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
    {% endif %}

    {% for i in fiches.paginator.page_range %}
      {% if fiches.number == i %}
        <li class="page-item active"><span class="page-link">{{ i }}</span></li>
      {% else %}
        <li class="page-item"><a class="page-link" href="?page={{ i }}{% if q %}&q={{ q|urlencode }}{% endif %}">{{ i }}</a></li>
      {% endif %}
    {% endfor %}

    {% if fiches.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ fiches.next_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
    {% endif %}
  </ul>
</nav>
{% endif %}
