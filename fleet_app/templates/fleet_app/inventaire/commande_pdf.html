<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commande {{ commande.numero }}</title>
    {% if mode_impression %}
    <!-- Inclure Bootstrap uniquement en mode impression HTML -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    {% endif %}
    <style>
        @page {
            size: A4;
            margin: 2cm;
        }
        body {
            font-family: Arial, sans-serif;
            font-size: 12px;
            line-height: 1.5;
            color: #333;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .header h1 {
            font-size: 18px;
            margin-bottom: 5px;
        }
        .info-bloc {
            margin-bottom: 20px;
            width: 100%;
        }
        .info-bloc table {
            width: 100%;
            border-collapse: collapse;
        }
        .info-bloc td {
            padding: 5px;
            vertical-align: top;
        }
        .info-bloc .label {
            font-weight: bold;
            width: 30%;
        }
        .info-bloc .value {
            width: 70%;
        }
        .commande-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .commande-table th, .commande-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .commande-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .commande-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .totals {
            width: 40%;
            margin-left: auto;
            margin-right: 0;
        }
        .totals table {
            width: 100%;
            border-collapse: collapse;
        }
        .totals td {
            padding: 5px;
            border: 1px solid #ddd;
        }
        .totals .label {
            font-weight: bold;
            text-align: right;
        }
        .totals .value {
            text-align: right;
        }
        .footer {
            margin-top: 30px;
            font-size: 10px;
            text-align: center;
            color: #666;
        }
        .status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 11px;
        }
        .status-brouillon { background-color: #e9ecef; color: #495057; }
        .status-attente { background-color: #fff3cd; color: #856404; }
        .status-validee { background-color: #d1e7dd; color: #0f5132; }
        .status-en-cours { background-color: #cff4fc; color: #055160; }
        .status-livree { background-color: #d1e7dd; color: #0f5132; }
        .status-annulee { background-color: #f8d7da; color: #842029; }
    </style>
</head>
<body>
    {% if mode_impression %}
    <div class="container-fluid mb-4 d-print-none">
        <div class="row py-3">
            <div class="col-md-6">
                <a href="{% url 'fleet_app:commande_detail' pk=commande.numero %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Retour à la commande
                </a>
            </div>
            <div class="col-md-6 text-end">
                <button onclick="window.print()" class="btn btn-primary">
                    <i class="fas fa-print"></i> Imprimer
                </button>
            </div>
        </div>
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> L'export PDF n'est pas disponible car les dépendances WeasyPrint ne sont pas installées. 
            Vous pouvez utiliser la fonction d'impression de votre navigateur pour générer un PDF.
        </div>
    </div>
    {% endif %}
    <div class="header">
        <h1>BON DE COMMANDE</h1>
        <p>Numéro: <strong>{{ commande.numero }}</strong></p>
    </div>

    <div class="info-bloc">
        <table>
            <tr>
                <td class="label">Fournisseur:</td>
                <td class="value">{{ commande.fournisseur }}</td>
                <td class="label">Statut:</td>
                <td class="value">
                    {% if commande.statut == 'Brouillon' %}
                        <span class="status status-brouillon">{{ commande.statut }}</span>
                    {% elif commande.statut == 'En attente' %}
                        <span class="status status-attente">{{ commande.statut }}</span>
                    {% elif commande.statut == 'Validée' %}
                        <span class="status status-validee">{{ commande.statut }}</span>
                    {% elif commande.statut == 'En cours' %}
                        <span class="status status-en-cours">{{ commande.statut }}</span>
                    {% elif commande.statut == 'Livrée' %}
                        <span class="status status-livree">{{ commande.statut }}</span>
                    {% elif commande.statut == 'Annulée' %}
                        <span class="status status-annulee">{{ commande.statut }}</span>
                    {% else %}
                        {{ commande.statut }}
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td class="label">Adresse:</td>
                <td class="value">{{ commande.adresse_fournisseur|default:"-" }}</td>
                <td class="label">Date de création:</td>
                <td class="value">{{ commande.date_creation|date:"d/m/Y" }}</td>
            </tr>
            <tr>
                <td class="label">Téléphone:</td>
                <td class="value">{{ commande.telephone_fournisseur|default:"-" }}</td>
                <td class="label">Livraison prévue:</td>
                <td class="value">{{ commande.date_livraison_prevue|date:"d/m/Y"|default:"-" }}</td>
            </tr>
            <tr>
                <td class="label">Email:</td>
                <td class="value">{{ commande.email_fournisseur|default:"-" }}</td>
                <td class="label">Créée par:</td>
                <td class="value">{{ commande.utilisateur.get_full_name|default:commande.utilisateur.username }}</td>
            </tr>
        </table>
    </div>

    <table class="commande-table">
        <thead>
            <tr>
                <th>Produit</th>
                <th>Catégorie</th>
                <th>Quantité</th>
                <th>Prix unitaire</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            {% for ligne in lignes %}
            <tr>
                <td>{{ ligne.produit.nom }}</td>
                <td>{{ ligne.produit.categorie }}</td>
                <td>{{ ligne.quantite }}</td>
                <td>{{ ligne.prix_unitaire|floatformat:2 }} GNF</td>
                <td>{{ ligne.prix_total|floatformat:2 }} GNF</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" style="text-align: center;">Aucun produit dans cette commande</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="totals">
        <table>
            <tr>
                <td class="label">Montant HT:</td>
                <td class="value">{{ montant_ht|floatformat:2|intcomma }} GNF</td>
            </tr>
            <tr>
                <td class="label">Remise ({{ remise_pourcentage|floatformat:2 }}%):</td>
                <td class="value">{{ montant_remise|floatformat:2|intcomma }} GNF</td>
            </tr>
            <tr>
                <td class="label">TVA ({{ taux_tva }}%):</td>
                <td class="value">{{ montant_tva|floatformat:2|intcomma }} GNF</td>
            </tr>
            <tr>
                <td class="label">Montant TTC:</td>
                <td class="value"><strong>{{ montant_ttc|floatformat:2|intcomma }} GNF</strong></td>
            </tr>
        </table>
    </div>

    {% if commande.notes %}
    <div class="info-bloc">
        <h3>Notes</h3>
        <p>{{ commande.notes }}</p>
    </div>
    {% endif %}

    <div class="footer">
        <p>Document généré le {{ date_impression|date:"d/m/Y à H:i" }}</p>
        <p>Ce document n'a pas de valeur contractuelle.</p>
    </div>
</body>
</html>
